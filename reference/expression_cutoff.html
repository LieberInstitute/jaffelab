<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Find expression cutoffs — expression_cutoff • jaffelab</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Find expression cutoffs — expression_cutoff"><meta property="og:description" content="This function finds expression cutoffs based on estimating the second
breakpoint using segmented applied to two curves. The
first curve is the number of features passing the cutoff assuming an initial
large drop, an intermediate section with moderate drop, and then a stable
tail. The second curve is the mean number of expressed samples (non-zero
expression) for all genes at each given cutoff. This curve increases rapidly
then has a section with a moderate increase, and finally a long tail. Using
segmented we find that second breakpoint. The suggested
expression cutoff returned is the average of the two suggested cutoffs."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jaffelab</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.99.32</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/jaffelab-quickstart.html">jaffelab quick start guide</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/LieberInstitute/jaffelab/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Find expression cutoffs</h1>
    <small class="dont-index">Source: <a href="https://github.com/LieberInstitute/jaffelab/blob/HEAD/R/expression_cutoff.R" class="external-link"><code>R/expression_cutoff.R</code></a></small>
    <div class="hidden name"><code>expression_cutoff.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function finds expression cutoffs based on estimating the second
breakpoint using <a href="https://rdrr.io/pkg/segmented/man/segmented.html" class="external-link">segmented</a> applied to two curves. The
first curve is the number of features passing the cutoff assuming an initial
large drop, an intermediate section with moderate drop, and then a stable
tail. The second curve is the mean number of expressed samples (non-zero
expression) for all genes at each given cutoff. This curve increases rapidly
then has a section with a moderate increase, and finally a long tail. Using
segmented we find that second breakpoint. The suggested
expression cutoff returned is the average of the two suggested cutoffs.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">expression_cutoff</span><span class="op">(</span><span class="va">expr</span>, max_cut <span class="op">=</span> <span class="fl">1</span>, seed <span class="op">=</span> <span class="cn">NULL</span>, n.boot <span class="op">=</span> <span class="fl">2000</span>, k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>expr</dt>
<dd><p>A matrix with the expression values with features in the rows and
samples in the columns in RPKM format (typically). <code>expr</code> can be any matrix
as <code>expression_cutoff()</code> will work with the row means of the matrix. You'll
most likely want to use a normalized expression matrix, although this
function will work with any matrix.</p></dd>
<dt>max_cut</dt>
<dd><p>Maximum expression cutoff to consider. Increasing this value
does then to increase the suggested cutoffs. If set to <code>NULL</code>, this
will be chosen automatically from 1 to 5.</p></dd>
<dt>seed</dt>
<dd><p>Set this argument for increased reproducibility of the results.
This is passed to <a href="https://rdrr.io/pkg/segmented/man/seg.control.html" class="external-link">seg.control</a>. We highly recommend
specifiying this value.</p></dd>
<dt>n.boot</dt>
<dd><p>This argument controls the stability of the suggested cutoffs.
It is passed to <a href="https://rdrr.io/pkg/segmented/man/seg.control.html" class="external-link">seg.control</a>.</p></dd>
<dt>k</dt>
<dd><p>The number of breakpoints to consider. If you increase this value
the estimated breakpoints are less stable.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A two element vector with the suggested cutoffs based on the
number of features expressed and the mean number of expressed samples
across all features. The function also makes plots that visualize
both curves and show the identified breakpoints as vertical grey lines.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Leonardo Collado-Torres</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="co">## Simulate expression data. Based on the limma::lmFit() man page</span></span>
<span class="r-in"><span class="va">sd</span> <span class="op">&lt;-</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">4</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html" class="external-link">rchisq</a></span><span class="op">(</span><span class="fl">100</span>, df <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fl">6</span>, sd <span class="op">=</span> <span class="va">sd</span><span class="op">)</span>, <span class="fl">100</span>, <span class="fl">6</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Gene"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span></span>
<span class="r-in"><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">+</span> <span class="fl">2</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Make the expression data look like RPKM values</span></span>
<span class="r-in"><span class="va">y2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">y</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">    <span class="va">res</span> <span class="op">&lt;-</span> <span class="va">z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in">    <span class="va">res</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span class="r-in">    <span class="va">res</span></span>
<span class="r-in"><span class="op">}</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">y2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        V1              V2               V3               V4        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Min.   :0.000   Min.   :0.0000   Min.   :0.0000   Min.   :0.0000  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1st Qu.:0.812   1st Qu.:0.5794   1st Qu.:0.6757   1st Qu.:0.7014  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Median :1.061   Median :0.8119   Median :0.9338   Median :1.0135  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Mean   :1.002   Mean   :0.8070   Mean   :0.8705   Mean   :0.9828  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3rd Qu.:1.264   3rd Qu.:1.0926   3rd Qu.:1.1058   3rd Qu.:1.2464  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Max.   :2.472   Max.   :2.1606   Max.   :1.9088   Max.   :3.3155  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        V5              V6       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Min.   :0.000   Min.   :0.000  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1st Qu.:1.107   1st Qu.:1.435  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Median :1.470   Median :1.699  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Mean   :1.364   Mean   :1.558  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3rd Qu.:1.710   3rd Qu.:1.894  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Max.   :3.563   Max.   :3.829  </span>
<span class="r-in"></span>
<span class="r-in"><span class="fu">expression_cutoff</span><span class="op">(</span><span class="va">y2</span><span class="op">)</span></span>
<span class="r-plt img"><img src="expression_cutoff-1.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="expression_cutoff-2.png" alt="" width="700" height="433"></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2021-12-13 17:34:26 the suggested expression cutoff is 0.78</span>
<span class="r-plt img"><img src="expression_cutoff-3.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> percent_features_cut  samples_nonzero_cut </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 0.79                 0.77 </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Or same the plots to a PDF file</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span><span class="st">"test_expression_cutoff.pdf"</span>, width <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">expression_cutoff</span><span class="op">(</span><span class="va">y2</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2021-12-13 17:34:26 the suggested expression cutoff is 0.78</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> percent_features_cut  samples_nonzero_cut </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 0.79                 0.77 </span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> agg_png </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       2 </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## View the pdf with the following code</span></span>
<span class="r-in"><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/browseURL.html" class="external-link">browseURL</a></span><span class="op">(</span><span class="st">"test_expression_cutoff.pdf"</span><span class="op">)</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Leonardo Collado-Torres, Andrew E. Jaffe, Emily E. Burke.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

